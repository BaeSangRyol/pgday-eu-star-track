<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">

    <title>PhoneGap Day EU Workshop</title>

    <!-- Bootstrap core CSS -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/styles.css" rel="stylesheet">



    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-72845162-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>

<body>
<div class="navbar navbar-default navbar-static-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">PhoneGap Day EU Essentials Workshop 2016</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a
                        href="https://github.com/hollyschinsky/spotify-browser"><img
                        src="images/icon-github.png" style="border: none;margin: -4px 0;height: 28px;width: 28px;"/>
                    GitHub
                    Project</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</div>


<div class="container">

<div class="row">

    <div class="col-xs-12 col-sm-8">
        <h1>Module 3&#58; Handling Network Status Change</h1>
        <!--<hr/>-->
        <h2 id="overview">Overview</h2>
<p>When building for mobile you should always take an offline-first approach. There will be times when the 
user has no network connectivity and their experience shouldn’t suffer as a result.
The Apple app store actually tests to ensure that you are handling an offline scenario when you submit your apps for review.</p>

<p>For example, Instagram notifies the user there’s no internet connection while you’re in the app using a notification
at the top of the screen:</p>

<p><img class="screenshot" src="images/instagram-off.png" /></p>

<p>When building PhoneGap apps you can easily check the current status of the connection using the [Cordova Network Information Plugin]
(https://github.com/apache/cordova-plugin-network-information). You can also setup event listeners to be notified when the 
connection goes from online to offline and vice versa and take action then accordingly.</p>

<p>In this lesson you will learn how to use this plugin to detect and listen for network changes and pop up a toast
notification to the user.</p>

<h2 id="requirements">Requirements</h2>
<p>Before you can code this feature, you’ll first need to add the Cordova Network Information Plugin to your project since it is not yet used in the Star Track base
app template.</p>

<ol>
  <li>
    <p>Open your terminal and use the PhoneGap CLI to add it now (the <code class="highlighter-rouge">--save</code> parameter will save the plugin to your <code class="highlighter-rouge">config.xml</code> file):</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>phonegap plugin add cordova-plugin-network-information --save
</code></pre>
    </div>

    <blockquote>
      <p>Be sure to visit the <a href="https://github.com/apache/cordova-plugin-network-information">Cordova Network Information Plugin Docs</a> to learn about any platform quirks and more things you can do 
  with this plugin.</p>
    </blockquote>
  </li>
</ol>

<h2 id="steps">Steps</h2>
<ol>
  <li>Open <code class="highlighter-rouge">www/index.html</code> and add a wifi icon to the <code class="highlighter-rouge">index</code> page <code class="highlighter-rouge">navbar</code> on the right side to indicate 
the current connection status. Font Awesome is already included in the project and has an icon you can use
with the name <code class="highlighter-rouge">fa-wifi</code>.</li>
</ol>

<p>Insert the new code snippet for the icon directly after this line for the index page (denoted by <code class="highlighter-rouge">data-page="index"</code>). The result will look like this below:</p>

<div class="highlighter-rouge"><pre class="highlight"><code> &lt;div class="navbar"&gt;
  &lt;div class="navbar-inner" data-page="index"&gt;
    &lt;div class="left"&gt;
    &lt;!--
        Left link contains only icon - additional "icon-only" class
        Additional "open-panel" class tells app to open panel when we click on this link
    --&gt;
    &lt;a href="#" class="link icon-only open-panel"&gt;&lt;i class="fa fa-bars"&gt;&lt;/i&gt;&lt;/a&gt;
    &lt;/div&gt;
    &lt;div class="center sliding"&gt;Search&lt;/div&gt;
    &lt;div class="right"&gt;
    &lt;!--
        Right icon indicates network connection               
    --&gt;
    &lt;a href="#" class="icon-only"&gt;&lt;i class="fa fa-wifi"&gt;&lt;/i&gt;&lt;/a&gt;
    &lt;/div&gt;
  &lt;/div&gt;
 &lt;/div&gt;    
</code></pre>
</div>

<p>The icon doesn’t actually do anything meaningful yet but we’ll add handling to change the color of it to
   indicate online/offline status.</p>

<blockquote>
  <p>Note that due to platform styling differences, we’re using different colors between the platforms to indicate
   online and offline.</p>
</blockquote>

<p><img class="screenshot-md2" src="images/ios-online-icon.png" />
   <img class="screenshot-md2" src="images/ios-offline-icon.png" /></p>

<ol>
  <li>
    <p>Now open the <code class="highlighter-rouge">www/js/my-app.js</code> file and add the following variable declaration to the top of the file under the <code class="highlighter-rouge">isIOS</code>
and <code class="highlighter-rouge">isMaterial</code> handling. This will keep the current network status in case we need to check it in other parts of the code.
We’ll begin by assuming it’s offline until the next step can determine it for sure.</p>

    <p>var offline = true;</p>
  </li>
  <li>
    <p>Next open the <code class="highlighter-rouge">www/js/my-app.js</code> file and add the following code to the <code class="highlighter-rouge">deviceready()</code> function.</p>

    <p>This code checks to ensure the plugin is available and then checks if the current 
 connection is none, indicating it would be offline. In this case it will set the color to gray on both
 platforms. It then adds event listeners to the <code class="highlighter-rouge">offline</code> and <code class="highlighter-rouge">online</code> events to listen for a change in 
 status to allow for further handling in those scenarios.</p>

    <p>if (navigator.connection &amp;&amp; navigator.connection.type == Connection.NONE) {
   <script type="math/tex">('.fa-wifi').addClass('color-gray');     
 }
 else {
   // It's connected, set a flag and icon colors
   offline = false;
   if (isIos)</script>(‘.fa-wifi’).addClass(‘color-green’);
   else $$(‘.fa-wifi’).addClass(‘color-white’);
 }</p>

    <p>// Add a listener to detect a change in the connection from online to offline and vice versa
 document.addEventListener(“offline”, onOffline, false);
 document.addEventListener(“online”, onOnline, false);</p>

    <blockquote>
      <p>You should always ensure you wait until the <code class="highlighter-rouge">deviceready</code> event is fired before using any Cordova 
 native plugins.</p>
    </blockquote>
  </li>
  <li>
    <p>Next we’ll add the functions for the onOffline and onOnline handlers. They both will display
a toast notification to indicate the status change and set the colors of the wifi icon on the main
page for visual notification. (See the <a href="http://framework7.io/docs/notifications.html">Framework7 notification docs</a> 
for more details on using these toast style notifications in your apps).</p>

    <ul>
      <li>
        <p>Add the function for the <code class="highlighter-rouge">onOffline</code> handler:</p>

        <p>function onOffline() {
      offline = true;
      myApp.addNotification({
           title: ‘Connection Status’,
           message: ‘A previously connected device has gone offline.’
      });
      if (isIos) <script type="math/tex">('.fa-wifi').removeClass('color-green').addClass('color-gray');
      else</script>(‘.fa-wifi’).removeClass(‘color-white’).addClass(‘color-gray’);          <br />
   }</p>
      </li>
    </ul>
  </li>
</ol>

<ul>
  <li>
    <p>Add the function for the <code class="highlighter-rouge">onOnline</code> handler:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>function onOnline() {
    // Show a toast notification to indicate the change
    myApp.addNotification({
        title: 'Connection Status',
        message: 'A previously connected device has come back online'
    });
    // Set the wifi icon colors to reflect the change
    if (isIos) $$('.fa-wifi').removeClass('color-gray').addClass('color-green');
    else $$('.fa-wifi').removeClass('color-gray').addClass('color-white');    
    offline = false;
}
</code></pre>
    </div>
  </li>
</ul>

<h2 id="run-it">Run it</h2>
<p>The end result should look like the following where you see a notification displayed when you go offline and
online.</p>

<p><img class="screenshot2" src="images/ios-network-detect.png" /></p>

<blockquote>
  <p>At this point you could further handle the experience as desired. You may want to store some data in local storage
or another on-device database to allow them to use the app with the cached data. Your app may also have data
that needs to be saved off to be synced to a server when you’re back online. The goal is to provide the most
optimal user experience.</p>
</blockquote>

<div class="row" style="margin-top:40px;">
<div class="col-sm-12">
<a href="lesson2.html" class="btn btn-default"><i class="glyphicon glyphicon-chevron-left"></i> Previous</a>
<a href="lesson4.html" class="btn btn-default pull-right">Next <i class="glyphicon
glyphicon-chevron-right"></i></a>
</div>
</div>



        <!--<div class="row" style="margin-top: 30px;">-->
            <!--<div class="col-xs-12">-->
                <!--<div id="disqus_thread"></div>-->
                <!--<script type="text/javascript">-->
                    <!--/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */-->
                    <!--var disqus_shortname = 'salesforcedeveloperworkshop'; // required: replace example with your forum shortname-->

                    <!--/* * * DON'T EDIT BELOW THIS LINE * * */-->
                    <!--(function() {-->
                        <!--var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;-->
                        <!--dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';-->
                        <!--(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);-->
                    <!--})();-->
                <!--</script>-->
                <!--<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>-->
                <!--<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>-->
            <!--</div>-->
        <!--</div>-->


    </div>

    <div class="col-xs-12 col-sm-4 right-nav">

        <div class="panel panel-default">
            <!-- Default panel contents -->
            <div class="panel-heading" style="font-variant:small-caps;font-size: 18px;">Modules</div>
            <ol class="list-group">
                <li><a href="lesson1.html">Project Setup/PhoneGap Tooling</a></li>
                <li><a href="lesson2.html">App Walkthru</a></li>
                <li><a href="lesson3.html">Detecting Offline</a></li>
                <li><a href="lesson4.html">Searchbar Filter</a></li>
                <li><a href="lesson5.html">Add Swipeout Action</a></li>
                <li><a href="lesson6.html">Add Native Share Feature</a></li>
                <li><a href="lesson7.html">Making Your App Feel Native</a></li>
                <li><a href="lesson8.html">Configuring Your App</a></li>
                <li><a href="lesson9.html">Next Steps</a></li>
                <li><a href="lesson10.html">Optional: Remote Debugging</a></li>
            </ol>
            <p></p>
        </div>

<a href="https://twitter.com/share" class="twitter-share-button" data-size="large"
   data-url="http://hollyschinsky.github.io/phonegap-workshop"
   data-text="PhoneGap Tutorial #Cordova #PhoneGap">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<a href="https://twitter.com/devgirlfl" class="twitter-follow-button" data-show-count="true"
   data-size="large" data-lang="en">Follow
    @devgirlfl</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

    </div>

</div>

</div>

<div class="container">
    <div id="footer">
        <a href="http://devgirl.org"><p class="text-muted">Holly Schinsky</p></a>
    </div>
</div>


<script src="lib/jquery.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>
</body>
</html>
